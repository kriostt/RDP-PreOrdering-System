{"version":3,"file":"previewAction.js","sources":["../../src/_internal/cli/actions/preview/previewAction.ts"],"sourcesContent":["import {type CliCommandArguments, type CliCommandContext, type CliConfig} from '@sanity/cli'\nimport path from 'path'\n\nimport {type PreviewServerOptions, startPreviewServer} from '../../server'\nimport {getSharedServerConfig, gracefulServerDeath} from '../../util/servers'\n\nexport interface StartPreviewServerCommandFlags {\n  host?: string\n  port?: string\n}\n\nexport default async function startSanityPreviewServer(\n  args: CliCommandArguments<StartPreviewServerCommandFlags>,\n  context: CliCommandContext,\n): Promise<void> {\n  const flags = args.extOptions\n  const {workDir, cliConfig} = context\n\n  const defaultRootDir = path.resolve(path.join(workDir, 'dist'))\n  const rootDir = path.resolve(args.argsWithoutOptions[0] || defaultRootDir)\n  const config = getPreviewServerConfig({flags, workDir, cliConfig, rootDir})\n\n  try {\n    await startPreviewServer(config)\n  } catch (err) {\n    gracefulServerDeath('preview', config.httpHost, config.httpPort, err)\n  }\n}\n\nfunction getPreviewServerConfig({\n  flags,\n  workDir,\n  cliConfig,\n  rootDir,\n}: {\n  flags: StartPreviewServerCommandFlags\n  rootDir: string\n  workDir: string\n  cliConfig?: CliConfig\n}): PreviewServerOptions {\n  const baseConfig = getSharedServerConfig({flags, workDir, cliConfig})\n  return {\n    ...baseConfig,\n    root: rootDir,\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAW8B,eAAA,yBAC5B,MACA,SACe;AACf,QAAM,QAAQ,KAAK,YACb,EAAC,SAAS,UAAS,IAAI,SAEvB,iBAAiB,KAAK,QAAQ,KAAK,KAAK,SAAS,MAAM,CAAC,GACxD,UAAU,KAAK,QAAQ,KAAK,mBAAmB,CAAC,KAAK,cAAc,GACnE,SAAS,uBAAuB,EAAC,OAAO,SAAS,WAAW,SAAQ;AAEtE,MAAA;AACF,UAAM,mBAAmB,MAAM;AAAA,WACxB,KAAK;AACZ,wBAAoB,WAAW,OAAO,UAAU,OAAO,UAAU,GAAG;AAAA,EACtE;AACF;AAEA,SAAS,uBAAuB;AAAA,EAC9B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAKyB;AAEhB,SAAA;AAAA,IACL,GAFiB,sBAAsB,EAAC,OAAO,SAAS,WAAU;AAAA,IAGlE,MAAM;AAAA,EAAA;AAEV;"}